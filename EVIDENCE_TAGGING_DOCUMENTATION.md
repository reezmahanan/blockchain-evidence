# Evidence Tagging System Documentation\n\n## Overview\nThe Evidence Tagging System provides flexible, multi-dimensional organization and categorization of evidence items through a comprehensive tagging interface with advanced filtering, batch operations, and role-based permissions.\n\n## Features\n\n### üè∑Ô∏è Core Tagging Features\n- **Multi-tag Support**: Apply multiple tags to each evidence item\n- **Color-coded Tags**: Visual categorization with customizable colors\n- **Tag Categories**: Organize tags by type (priority, status, type, sensitivity)\n- **Tag Hierarchies**: Parent-child relationships for complex organization\n- **Usage Statistics**: Track tag popularity and usage patterns\n\n### üîç Advanced Filtering\n- **AND/OR Logic**: Filter evidence by single or multiple tags\n- **Real-time Search**: Instant filtering with fuzzy matching\n- **Filter Presets**: Save common filter combinations\n- **Tag-based Search**: Find evidence by tag combinations\n\n### ‚ö° Batch Operations\n- **Bulk Tagging**: Apply tags to multiple evidence items simultaneously\n- **Mass Operations**: Edit, remove, or merge tags in bulk\n- **Progress Tracking**: Monitor large batch operations\n- **Undo Functionality**: Reverse batch operations if needed\n\n### üìä Management & Analytics\n- **Tag Statistics**: Usage counts and trend analysis\n- **Popular Tags**: Most frequently used tags dashboard\n- **Tag Lifecycle**: Create, edit, delete, and merge tags\n- **Duplicate Detection**: Identify and consolidate similar tags\n\n## API Endpoints\n\n### Tag Management\n\n#### Get All Tags\n```http\nGET /api/tags\n```\nReturns all tags with usage statistics, ordered by popularity.\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"tags\": [\n    {\n      \"id\": 1,\n      \"name\": \"urgent\",\n      \"color\": \"#EF4444\",\n      \"category\": \"priority\",\n      \"usage_count\": 25,\n      \"created_by\": \"0x123...\",\n      \"created_at\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n#### Create New Tag\n```http\nPOST /api/tags\nContent-Type: application/json\n\n{\n  \"name\": \"court-ready\",\n  \"color\": \"#10B981\",\n  \"category\": \"status\",\n  \"userWallet\": \"0x123...\"\n}\n```\n\n#### Add Tags to Evidence\n```http\nPOST /api/evidence/{id}/tags\nContent-Type: application/json\n\n{\n  \"tagIds\": [1, 2, 3],\n  \"userWallet\": \"0x123...\"\n}\n```\n\n#### Remove Tag from Evidence\n```http\nDELETE /api/evidence/{id}/tags/{tagId}\nContent-Type: application/json\n\n{\n  \"userWallet\": \"0x123...\"\n}\n```\n\n### Batch Operations\n\n#### Batch Tag Evidence\n```http\nPOST /api/evidence/batch-tag\nContent-Type: application/json\n\n{\n  \"evidenceIds\": [1, 2, 3, 4],\n  \"tagIds\": [1, 5],\n  \"userWallet\": \"0x123...\"\n}\n```\n\n### Filtering & Search\n\n#### Filter Evidence by Tags\n```http\nGET /api/evidence/by-tags?tagIds=1,2,3&logic=AND\n```\n\n**Parameters:**\n- `tagIds`: Comma-separated list of tag IDs\n- `logic`: \"AND\" (evidence must have all tags) or \"OR\" (evidence must have any tag)\n\n#### Auto-suggest Tags\n```http\nGET /api/tags/suggest?query=urg&limit=5\n```\n\n## Database Schema\n\n### Tags Table\n```sql\nCREATE TABLE tags (\n    id SERIAL PRIMARY KEY,\n    name TEXT UNIQUE NOT NULL,\n    color TEXT DEFAULT '#3B82F6',\n    category TEXT,\n    parent_id INTEGER REFERENCES tags(id),\n    usage_count INTEGER DEFAULT 0,\n    created_by TEXT NOT NULL,\n    created_at TIMESTAMPTZ DEFAULT NOW()\n);\n```\n\n### Evidence Tags Junction Table\n```sql\nCREATE TABLE evidence_tags (\n    evidence_id INTEGER REFERENCES evidence(id) ON DELETE CASCADE,\n    tag_id INTEGER REFERENCES tags(id) ON DELETE CASCADE,\n    tagged_by TEXT NOT NULL,\n    tagged_at TIMESTAMPTZ DEFAULT NOW(),\n    PRIMARY KEY (evidence_id, tag_id)\n);\n```\n\n### Indexes for Performance\n```sql\nCREATE INDEX idx_tags_name ON tags(name);\nCREATE INDEX idx_tags_category ON tags(category);\nCREATE INDEX idx_tags_usage_count ON tags(usage_count DESC);\nCREATE INDEX idx_evidence_tags_evidence_id ON evidence_tags(evidence_id);\nCREATE INDEX idx_evidence_tags_tag_id ON evidence_tags(tag_id);\n```\n\n## JavaScript Usage\n\n### Initialize Tag Manager\n```javascript\nconst tagManager = new TagManager(userWallet);\nawait tagManager.init();\n```\n\n### Create Tag Input Component\n```javascript\nconst tagInput = tagManager.createTagInput('tag-container', {\n    placeholder: 'Add tags...',\n    maxTags: 10,\n    allowCreate: true,\n    onTagAdd: (tags) => console.log('Tags updated:', tags),\n    onTagRemove: (tags) => console.log('Tags updated:', tags)\n});\n```\n\n### Create Tag Filter Component\n```javascript\ntagManager.createTagFilter('filter-container', (filteredEvidence) => {\n    if (filteredEvidence) {\n        displayEvidence(filteredEvidence);\n    } else {\n        displayAllEvidence();\n    }\n});\n```\n\n### Batch Operations\n```javascript\n// Tag multiple evidence items\nconst taggedCount = await tagManager.batchTag([1, 2, 3], [4, 5]);\nconsole.log(`Tagged ${taggedCount} evidence items`);\n\n// Filter evidence by tags\nconst filtered = await tagManager.filterByTags([1, 2], 'AND');\nconsole.log('Filtered evidence:', filtered);\n```\n\n## Role-Based Permissions\n\n| Role | Create Tags | Apply Tags | Delete Tags | View Analytics |\n|------|-------------|------------|-------------|----------------|\n| Public Viewer | ‚ùå | ‚ùå | ‚ùå | ‚ùå |\n| Investigator | ‚úÖ | ‚úÖ | Own Only | ‚ùå |\n| Forensic Analyst | ‚úÖ | ‚úÖ | Own Only | ‚ùå |\n| Legal Professional | ‚úÖ | ‚úÖ | Own Only | ‚ùå |\n| Court Official | ‚úÖ | ‚úÖ | Own Only | ‚ùå |\n| Evidence Manager | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |\n| Auditor | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |\n| Administrator | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |\n\n## Use Cases\n\n### Investigation Workflow\n1. **Evidence Collection**: Tag evidence by source, type, and priority\n   - `crime-scene-A`, `witness-statement`, `urgent`\n\n2. **Analysis Phase**: Mark evidence status and requirements\n   - `pending-review`, `forensic-analysis`, `needs-expert`\n\n3. **Legal Preparation**: Organize evidence for court proceedings\n   - `court-exhibit`, `defense-evidence`, `prosecution-key`\n\n4. **Case Management**: Track evidence across multiple cases\n   - `case-2024-001`, `related-case-456`, `multi-case`\n\n### Common Tag Categories\n\n#### Priority Tags\n- `urgent` - Requires immediate attention\n- `high-priority` - Important but not urgent\n- `routine` - Standard processing\n- `archived` - Historical reference\n\n#### Status Tags\n- `pending-review` - Awaiting analysis\n- `in-progress` - Currently being processed\n- `completed` - Analysis finished\n- `court-ready` - Prepared for legal proceedings\n\n#### Type Tags\n- `witness-statement` - Testimony and interviews\n- `surveillance-footage` - Video evidence\n- `forensic-analysis` - Scientific examination results\n- `digital-evidence` - Electronic data\n\n#### Sensitivity Tags\n- `confidential` - Restricted access\n- `public` - Can be disclosed\n- `classified` - Highest security level\n- `sensitive` - Requires careful handling\n\n## Best Practices\n\n### Tag Naming Conventions\n- Use lowercase with hyphens: `crime-scene-a`\n- Be descriptive but concise: `pending-forensic-review`\n- Avoid special characters except hyphens\n- Use consistent terminology across cases\n\n### Tag Organization\n- Group related tags by category\n- Use hierarchical relationships for complex classifications\n- Regularly review and consolidate duplicate tags\n- Archive unused tags rather than deleting\n\n### Performance Optimization\n- Limit tags per evidence item (recommended: 5-10)\n- Use batch operations for large-scale tagging\n- Regularly clean up unused tags\n- Monitor tag usage statistics for optimization\n\n## Troubleshooting\n\n### Common Issues\n\n#### Tags Not Loading\n- Check network connectivity\n- Verify user authentication\n- Ensure database connection is active\n\n#### Batch Operations Failing\n- Reduce batch size (max 50 items recommended)\n- Check user permissions for all selected evidence\n- Verify tag IDs exist and are accessible\n\n#### Filter Not Working\n- Clear browser cache and reload\n- Check tag IDs in filter parameters\n- Verify evidence has the specified tags\n\n### Error Messages\n\n#### \"Tag already exists\"\n- Tag names must be unique\n- Check for similar existing tags\n- Consider using different category or modifier\n\n#### \"Unauthorized access\"\n- Verify user role permissions\n- Check wallet address authentication\n- Ensure user account is active\n\n#### \"Failed to create tag\"\n- Check required fields (name, userWallet)\n- Verify database connectivity\n- Check for special characters in tag name\n\n## Security Considerations\n\n### Input Validation\n- All tag names are sanitized and validated\n- XSS prevention through proper escaping\n- SQL injection protection via parameterized queries\n\n### Access Control\n- Role-based permissions enforced at API level\n- User authentication required for all operations\n- Audit logging for all tag operations\n\n### Data Integrity\n- Foreign key constraints prevent orphaned records\n- Triggers maintain usage count accuracy\n- Soft delete preserves audit trail\n\n## Performance Metrics\n\n### Benchmarks\n- Tag loading: < 500ms for 1000+ tags\n- Filter operations: < 200ms for complex queries\n- Batch tagging: < 2s for 50 evidence items\n- Auto-suggest: < 100ms response time\n\n### Optimization Tips\n- Use database indexes for frequent queries\n- Cache popular tags in browser storage\n- Implement pagination for large tag lists\n- Use debouncing for search inputs\n\n## Future Enhancements\n\n### Planned Features\n- AI-powered tag suggestions based on evidence content\n- Tag templates for common investigation types\n- Advanced analytics with trend analysis\n- Tag-based workflow automation\n- Integration with external classification systems\n- Multi-language tag support\n\n### API Versioning\n- Current version: v1\n- Backward compatibility maintained\n- Deprecation notices for breaking changes\n- Migration guides for major updates