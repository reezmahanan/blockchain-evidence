<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Premium SEO & Meta -->
    <title>EVID-DGC ¬∑ Forensic Command Center</title>
    <meta name="description" content="Advanced digital forensics and evidence analysis platform - Blockchain secured">
    <meta name="theme-color" content="#d32f2f">
    
    <!-- Critical CSS -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="responsive-improvements.css">
    
    <!-- Favicon Suite -->
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    
    <!-- Premium Font Loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons - Pinned to specific version with Subresource Integrity -->
    <script src="https://unpkg.com/lucide@0.344.0" integrity="sha384-Kl3cQhNN0eOsiHm8vPcqgY72Lp6P/9GPQOJGfQnN/zTbtFTl4tYxQ+UqIsb0m0Y0" crossorigin="anonymous"></script>
</head>

<body>
    <!-- Navigation will be injected by navbar.js -->
    
    <!-- ===== PREMIUM FORENSIC HERO ===== -->
    <div class="forensic-hero">
        <div class="hero-content">
            <div class="hero-badge">
                <i data-lucide="microscope"></i>
                <span>Forensic Laboratory ‚Ä¢ Level 3 Access</span>
            </div>
            <h1>
                <span class="hero-highlight">Digital Evidence</span><br>
                Analysis Command
            </h1>
            <p class="hero-subtitle">
                Advanced forensic tools with blockchain-verified chain of custody. 
                Every analysis is timestamped and immutable.
            </p>
            
            <!-- Premium Stats Cards -->
            <div class="stats-grid-premium">
                <div class="stat-card-premium">
                    <div class="stat-icon">
                        <i data-lucide="activity"></i>
                    </div>
                    <div class="stat-number" id="pendingAnalysis">0</div>
                    <div class="stat-label">Pending Analysis</div>
                </div>
                <div class="stat-card-premium">
                    <div class="stat-icon">
                        <i data-lucide="check-circle"></i>
                    </div>
                    <div class="stat-number" id="completedAnalysis">0</div>
                    <div class="stat-label">Completed Today</div>
                </div>
                <div class="stat-card-premium">
                    <div class="stat-icon">
                        <i data-lucide="cpu"></i>
                    </div>
                    <div class="stat-number" id="activeTools">0</div>
                    <div class="stat-label">Active Tools</div>
                </div>
                <div class="stat-card-premium">
                    <div class="stat-icon">
                        <i data-lucide="shield"></i>
                    </div>
                    <div class="stat-number" id="verifiedItems">0</div>
                    <div class="stat-label">Verified Items</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- ===== PREMIUM ANALYSIS TOOLS ===== -->
        <div class="card" style="margin-top: 0;">
            <div class="section-header">
                <div>
                    <h2>Forensic Toolkit</h2>
                    <p>Specialized analysis instruments with blockchain integration</p>
                </div>
                <button class="btn btn-outline btn-sm" onclick="refreshTools()">
                    <i data-lucide="refresh-cw"></i>
                    Sync Tools
                </button>
            </div>
            
            <div class="tools-grid-premium">
                <div class="tool-card-premium" onclick="openDigitalForensics()">
                    <div class="tool-icon">
                        <i data-lucide="hard-drive"></i>
                    </div>
                    <h3>Digital Forensics</h3>
                    <p>File system analysis, deleted file recovery, metadata extraction, timeline reconstruction</p>
                </div>
                
                <div class="tool-card-premium" onclick="openDNAAnalysis()">
                    <div class="tool-icon">
                        <i data-lucide="dna"></i>
                    </div>
                    <h3>DNA Analysis</h3>
                    <p>STR profiling, CODIS comparison, mixture interpretation, statistical calculations</p>
                </div>
                
                <div class="tool-card-premium" onclick="openBallistics()">
                    <div class="tool-icon">
                        <i data-lucide="crosshair"></i>
                    </div>
                    <h3>Ballistics</h3>
                    <p>Bullet comparison, trajectory reconstruction, gunshot residue testing</p>
                </div>
                
                <div class="tool-card-premium" onclick="openToxicology()">
                    <div class="tool-icon">
                        <i data-lucide="flask-conical"></i>
                    </div>
                    <h3>Toxicology</h3>
                    <p>Substance identification, concentration measurement, drug screening</p>
                </div>
                
                <div class="tool-card-premium" onclick="openDocumentAnalysis()">
                    <div class="tool-icon">
                        <i data-lucide="file-text"></i>
                    </div>
                    <h3>Document Analysis</h3>
                    <p>Handwriting comparison, ink analysis, alteration detection, signature verification</p>
                </div>
                
                <div class="tool-card-premium" onclick="openImageAnalysis()">
                    <div class="tool-icon">
                        <i data-lucide="camera"></i>
                    </div>
                    <h3>Image Analysis</h3>
                    <p>Photo enhancement, tampering detection, facial recognition, 3D reconstruction</p>
                </div>
            </div>
        </div>
        
        <!-- ===== PREMIUM EVIDENCE QUEUE ===== -->
        <div class="card">
            <div class="queue-header">
                <div>
                    <h2>Evidence Analysis Queue</h2>
                    <p>Prioritized cases awaiting forensic examination</p>
                </div>
                <div class="queue-filters">
                    <button class="filter-chip active" onclick="filterQueue(event, 'all')">
                        <i data-lucide="list"></i>
                        All
                    </button>
                    <button class="filter-chip" onclick="filterQueue(event, 'high')">
                        <i data-lucide="alert-triangle"></i>
                        High
                    </button>
                    <button class="filter-chip" onclick="filterQueue(event, 'pending')">
                        <i data-lucide="clock"></i>
                        Pending
                    </button>
                    <button class="filter-chip" onclick="filterQueue(event, 'processing')">
                        <i data-lucide="loader"></i>
                        Processing
                    </button>
                </div>
            </div>
            
            <div class="evidence-grid-premium" id="evidenceQueue">
                <!-- Evidence cards will be dynamically inserted here -->
            </div>
        </div>
        
        <!-- ===== PREMIUM LAB EQUIPMENT STATUS ===== -->
        <div class="card">
            <div class="section-header">
                <div>
                    <h2>Laboratory Equipment</h2>
                    <p>Real-time monitoring of forensic instruments</p>
                </div>
                <span class="badge badge-info" style="background: #eff6ff; color: #1e40af;">
                    <i data-lucide="activity" style="width: 14px; height: 14px; margin-right: 4px;"></i>
                    All Systems Nominal
                </span>
            </div>
            
            <div class="equipment-grid">
                <div class="equipment-card">
                    <div class="equipment-icon">
                        <i data-lucide="monitor"></i>
                    </div>
                    <div class="equipment-info">
                        <h4>Digital Workstation</h4>
                        <span class="status-online">
                            <i data-lucide="circle"></i>
                            Online ‚Ä¢ CPU 45%
                        </span>
                    </div>
                </div>
                
                <div class="equipment-card">
                    <div class="equipment-icon">
                        <i data-lucide="dna"></i>
                    </div>
                    <div class="equipment-info">
                        <h4>DNA Sequencer</h4>
                        <span class="status-online">
                            <i data-lucide="circle"></i>
                            Running ‚Ä¢ Sample 2/3
                        </span>
                    </div>
                </div>
                
                <div class="equipment-card">
                    <div class="equipment-icon">
                        <i data-lucide="scanner"></i>
                    </div>
                    <div class="equipment-info">
                        <h4>Image Scanner</h4>
                        <span class="status-maintenance">
                            <i data-lucide="alert-circle"></i>
                            Maintenance ‚Ä¢ Mar 20
                        </span>
                    </div>
                </div>
                
                <div class="equipment-card">
                    <div class="equipment-icon">
                        <i data-lucide="flask-conical"></i>
                    </div>
                    <div class="equipment-info">
                        <h4>Chemical Analyzer</h4>
                        <span class="status-online">
                            <i data-lucide="circle"></i>
                            Ready ‚Ä¢ Calibrated
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ===== PREMIUM MODAL ===== -->
    <div id="analysisModal" class="modal-premium">
        <div class="modal-content-premium">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2 style="font-size: 24px; font-weight: 700; color: var(--forensic-gray-900);" id="modalTitle">
                    Analysis Details
                </h2>
                <button onclick="closeModal()" style="background: none; border: none; cursor: pointer; padding: 8px;">
                    <i data-lucide="x" style="width: 20px; height: 20px; color: var(--forensic-gray-500);"></i>
                </button>
            </div>
            <div id="modalContent">
                <!-- Dynamic content will be inserted here -->
            </div>
        </div>
    </div>
    
    <script src="fixed-navbar.js"></script>
    <script>
        // ===== PREMIUM FORENSIC DASHBOARD =====
        // Strict Red & White Theme - No Purple Allowed
        
        let currentUser = null;
        let currentFilter = 'all';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Lucide icons
            lucide.createIcons();
            // Initialize dashboard
            initializeForensicDashboard();
        });
        
        // Safe JSON parse helper function
        function safeJsonParse(jsonString, defaultValue, isArray = false) {
            if (!jsonString) return defaultValue;
            
            try {
                const parsed = JSON.parse(jsonString);
                
                // Validate based on expected type
                if (isArray && !Array.isArray(parsed)) {
                    console.warn('Expected array but got:', typeof parsed);
                    return defaultValue;
                }
                
                if (!isArray && (typeof parsed !== 'object' || parsed === null)) {
                    console.warn('Expected object but got:', typeof parsed);
                    return defaultValue;
                }
                
                return parsed;
            } catch (e) {
                console.error('JSON parse error:', e);
                return defaultValue;
            }
        }
        
        async function initializeForensicDashboard() {
            try {
                // Check authentication
                const userAccount = localStorage.getItem('currentUser');
                if (!userAccount) {
                    window.location.href = 'index.html';
                    return;
                }
                
                // Load user data with error handling
                let userData = {};
                try {
                    const storedUser = localStorage.getItem('evidUser_' + userAccount);
                    if (storedUser) {
                        userData = safeJsonParse(storedUser, {}, false);
                    }
                } catch (e) {
                    console.error('Error accessing user data:', e);
                }
                
                if (!userData.role) {
                    const selectedRole = localStorage.getItem('selectedRole');
                    if (selectedRole) {
                        userData.role = selectedRole;
                        userData.fullName = localStorage.getItem('testUserName') || 'Forensic Analyst';
                        userData.walletAddress = userAccount;
                        
                        try {
                            localStorage.setItem('evidUser_' + userAccount, JSON.stringify(userData));
                        } catch (e) {
                            console.error('Failed to save user data:', e);
                        }
                    } else {
                        showNotification('Session expired. Please login again.', 'error');
                        setTimeout(() => logout(), 2000);
                        return;
                    }
                }
                
                currentUser = userData;
                updateUserInterface();
                loadForensicData();
                
            } catch (error) {
                console.error('Forensic dashboard error:', error);
                showNotification('Failed to initialize forensic tools', 'error');
            }
        }
        
        function updateUserInterface() {
            const isTestUser = localStorage.getItem('testUserMode') === 'true';
            const userName = currentUser.fullName || 'Forensic Analyst';
            
            const userRoleEl = document.getElementById('userRole');
            const userWalletEl = document.getElementById('userWallet');
            
            if (userRoleEl) {
                userRoleEl.textContent = isTestUser ? `üî¨ ${userName} (Test)` : 'üî¨ Forensic Analyst';
            }
            
            if (userWalletEl && currentUser.walletAddress) {
                userWalletEl.textContent = currentUser.walletAddress.slice(0, 6) + '...' + currentUser.walletAddress.slice(-4);
            }
        }
        
        function loadForensicData() {
            // Load real data from localStorage with error handling
            let cases = [];
            let evidence = [];
            
            try {
                cases = safeJsonParse(localStorage.getItem('cases'), [], true);
                evidence = safeJsonParse(localStorage.getItem('evidence'), [], true);
            } catch (e) {
                console.error('Error loading data from localStorage:', e);
            }
            
            // Calculate actual counts from data
            const pendingAnalysis = evidence.filter(e => e.status === 'pending' || e.status === 'Pending').length;
            const completedAnalysis = evidence.filter(e => e.status === 'verified' || e.status === 'Verified').length;
            const verifiedItems = evidence.filter(e => e.blockchainVerified || e.verified).length;
            
            // Animate stats with actual values
            animateValue('pendingAnalysis', 0, pendingAnalysis, 800);
            animateValue('completedAnalysis', 0, completedAnalysis, 800);
            animateValue('activeTools', 0, 4, 800); // Static value for demo
            animateValue('verifiedItems', 0, verifiedItems, 800);
        }
        
        function animateValue(elementId, start, end, duration) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= end) {
                    current = end;
                    clearInterval(timer);
                }
                element.textContent = Math.round(current);
            }, 16);
        }
        
        // ===== TOOL FUNCTIONS =====
        function openDigitalForensics() {
            showModal(
                'Digital Forensics Suite',
                `<div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="display: flex; gap: 16px; align-items: center;">
                        <div style="width: 64px; height: 64px; background: var(--forensic-red-muted); border-radius: 18px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="hard-drive" style="width: 32px; height: 32px; color: var(--forensic-red);"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">Digital Forensics v3.2</h3>
                            <p style="color: var(--forensic-gray-500);">Blockchain-integrated analysis suite</p>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div style="padding: 16px; background: var(--forensic-red-soft); border-radius: 16px;">
                            <strong style="color: var(--forensic-red-dark);">File System</strong>
                            <p style="margin-top: 8px; font-size: 14px;">NTFS, APFS, EXT4, FAT32</p>
                        </div>
                        <div style="padding: 16px; background: var(--forensic-red-soft); border-radius: 16px;">
                            <strong style="color: var(--forensic-red-dark);">Recovery Rate</strong>
                            <p style="margin-top: 8px; font-size: 14px;">94% deleted files</p>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="startDigitalForensics()" style="width: 100%;">
                        <i data-lucide="play"></i>
                        Initialize Analysis
                    </button>
                </div>`
            );
        }
        
        function openDNAAnalysis() {
            showModal(
                'DNA Analysis Workstation',
                `<div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="display: flex; gap: 16px; align-items: center;">
                        <div style="width: 64px; height: 64px; background: var(--forensic-red-muted); border-radius: 18px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="dna" style="width: 32px; height: 32px; color: var(--forensic-red);"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">DNA Profiler Pro</h3>
                            <p style="color: var(--forensic-gray-500);">CODIS-compatible analysis</p>
                        </div>
                    </div>
                    <div style="background: linear-gradient(to right, var(--forensic-red-soft), white); padding: 20px; border-radius: 16px;">
                        <strong style="color: var(--forensic-red-dark);">Available Protocols:</strong>
                        <ul style="margin-top: 12px; list-style: none; padding: 0;">
                            <li style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <i data-lucide="check-circle" style="width: 16px; height: 16px; color: #10b981;"></i>
                                STR Analysis (16 markers)
                            </li>
                            <li style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <i data-lucide="check-circle" style="width: 16px; height: 16px; color: #10b981;"></i>
                                mtDNA Sequencing
                            </li>
                            <li style="display: flex; align-items: center; gap: 8px;">
                                <i data-lucide="check-circle" style="width: 16px; height: 16px; color: #10b981;"></i>
                                Y-STR Profiling
                            </li>
                        </ul>
                    </div>
                    <button class="btn btn-primary" onclick="startDNAAnalysis()" style="width: 100%;">
                        <i data-lucide="flask"></i>
                        Start DNA Processing
                    </button>
                </div>`
            );
        }
        
        function openBallistics() {
            showModal(
                'Ballistics Analysis',
                `<div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="display: flex; gap: 16px; align-items: center;">
                        <div style="width: 64px; height: 64px; background: var(--forensic-red-muted); border-radius: 18px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="crosshair" style="width: 32px; height: 32px; color: var(--forensic-red);"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">Ballistics Match System</h3>
                            <p style="color: var(--forensic-gray-500);">IBIS-compatible analysis</p>
                        </div>
                    </div>
                    <p style="color: var(--forensic-gray-600); line-height: 1.6;">
                        Automated bullet and cartridge case comparison with 3D trajectory reconstruction. 
                        Blockchain verification ensures evidence integrity.
                    </p>
                    <button class="btn btn-primary" onclick="startBallisticsAnalysis()" style="width: 100%;">
                        <i data-lucide="target"></i>
                        Initialize Ballistics Scan
                    </button>
                </div>`
            );
        }
        
        function openToxicology() {
            showModal(
                'Toxicology Analyzer',
                `<div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="display: flex; gap: 16px; align-items: center;">
                        <div style="width: 64px; height: 64px; background: var(--forensic-red-muted); border-radius: 18px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="flask-conical" style="width: 32px; height: 32px; color: var(--forensic-red);"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">Toxicology Suite</h3>
                            <p style="color: var(--forensic-gray-500);">GC-MS & LC-MS Integration</p>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div style="background: #f8fafc; padding: 12px; border-radius: 12px;">
                            <span style="font-size: 12px; color: var(--forensic-gray-500);">Drug Screening</span>
                            <div style="font-size: 20px; font-weight: 700; margin-top: 4px;">48h</div>
                            <span style="font-size: 12px;">turnaround</span>
                        </div>
                        <div style="background: #f8fafc; padding: 12px; border-radius: 12px;">
                            <span style="font-size: 12px; color: var(--forensic-gray-500);">Accuracy</span>
                            <div style="font-size: 20px; font-weight: 700; margin-top: 4px;">99.8%</div>
                            <span style="font-size: 12px;">validated</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="startToxicology()" style="width: 100%;">
                        <i data-lucide="beaker"></i>
                        Run Toxicology Panel
                    </button>
                </div>`
            );
        }
        
        function openDocumentAnalysis() {
            showModal(
                'Document Examination',
                `<div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="display: flex; gap: 16px; align-items: center;">
                        <div style="width: 64px; height: 64px; background: var(--forensic-red-muted); border-radius: 18px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="file-text" style="width: 32px; height: 32px; color: var(--forensic-red);"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">Document Forensics</h3>
                            <p style="color: var(--forensic-gray-500);">Questioned Document Analysis</p>
                        </div>
                    </div>
                    <p style="color: var(--forensic-gray-600); line-height: 1.6;">
                        AI-powered handwriting comparison, ink chromatography, and alteration detection. 
                        Blockchain timestamp for every examination.
                    </p>
                    <button class="btn btn-primary" onclick="startDocumentAnalysis()" style="width: 100%;">
                        <i data-lucide="scan"></i>
                        Scan Document
                    </button>
                </div>`
            );
        }
        
        function openImageAnalysis() {
            showModal(
                'Image Forensics',
                `<div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="display: flex; gap: 16px; align-items: center;">
                        <div style="width: 64px; height: 64px; background: var(--forensic-red-muted); border-radius: 18px; display: flex; align-items: center; justify-content: center;">
                            <i data-lucide="camera" style="width: 32px; height: 32px; color: var(--forensic-red);"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">Image Analysis</h3>
                            <p style="color: var(--forensic-gray-500);">Digital Image Forensics</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 16px;">
                        <div style="flex: 1; text-align: center; padding: 16px; background: #f8fafc; border-radius: 12px;">
                            <i data-lucide="layers" style="width: 24px; height: 24px; color: var(--forensic-red);"></i>
                            <div style="margin-top: 8px; font-weight: 600;">Metadata</div>
                        </div>
                        <div style="flex: 1; text-align: center; padding: 16px; background: #f8fafc; border-radius: 12px;">
                            <i data-lucide="shield" style="width: 24px; height: 24px; color: var(--forensic-red);"></i>
                            <div style="margin-top: 8px; font-weight: 600;">Tamper Detect</div>
                        </div>
                        <div style="flex: 1; text-align: center; padding: 16px; background: #f8fafc; border-radius: 12px;">
                            <i data-lucide="face" style="width: 24px; height: 24px; color: var(--forensic-red);"></i>
                            <div style="margin-top: 8px; font-weight: 600;">Recognition</div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="startImageAnalysis()" style="width: 100%;">
                        <i data-lucide="upload"></i>
                        Upload & Analyze Image
                    </button>
                </div>`
            );
        }
        
        // ===== EVIDENCE ACTIONS =====
        function startAnalysis(caseId) {
            showNotification(`üî¨ Analysis initialized for case ${caseId}`, 'info');
        }
        
        function continueAnalysis(caseId) {
            showNotification(`‚èØÔ∏è Resuming analysis for case ${caseId}`, 'info');
        }
        
        function viewEvidenceDetails(caseId) {
            showModal(
                'Evidence Details',
                `<div style="display: flex; flex-direction: column; gap: 16px;">
                    <div style="background: var(--forensic-red-soft); padding: 16px; border-radius: 16px;">
                        <strong style="color: var(--forensic-red-dark);">Case ID: ${caseId}</strong>
                        <p style="margin-top: 8px; color: var(--forensic-gray-600);">
                            Chain of custody verified ‚Ä¢ Blockchain timestamped
                        </p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div>
                            <span style="font-size: 12px; color: var(--forensic-gray-500);">Collection Date</span>
                            <p style="font-weight: 600;">2024-03-15</p>
                        </div>
                        <div>
                            <span style="font-size: 12px; color: var(--forensic-gray-500);">Collected By</span>
                            <p style="font-weight: 600;">Det. Johnson</p>
                        </div>
                        <div>
                            <span style="font-size: 12px; color: var(--forensic-gray-500);">Storage Location</span>
                            <p style="font-weight: 600;">Vault A-12</p>
                        </div>
                        <div>
                            <span style="font-size: 12px; color: var(--forensic-gray-500);">Blockchain TX</span>
                            <p style="font-weight: 600; font-family: monospace;">0x7f3a...b9c2</p>
                        </div>
                    </div>
                </div>`
            );
        }
        
        function showProgressReport(caseId) {
            showNotification(`üìä Generating progress report for ${caseId}`, 'info');
        }
        
        function viewAnalysisReport(caseId) {
            showModal(
                'Analysis Report',
                `<div style="display: flex; flex-direction: column; gap: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="font-size: 18px; font-weight: 700;">Case ${caseId}</h3>
                        <span class="badge badge-success">COMPLETED</span>
                    </div>
                    <div style="background: #f8fafc; padding: 16px; border-radius: 12px;">
                        <p style="color: var(--forensic-gray-700); margin-bottom: 12px;">
                            <strong>Findings:</strong> Document authenticated. Signature matches reference sample.
                        </p>
                        <p style="color: var(--forensic-gray-600); font-size: 14px;">
                            <strong>Methodology:</strong> Handwriting analysis, ink chromatography, digital verification
                        </p>
                    </div>
                    <button class="btn btn-primary" onclick="downloadReport('${caseId}')">
                        <i data-lucide="download"></i>
                        Download Full Report
                    </button>
                </div>`
            );
        }
        
        function archiveEvidence(caseId) {
            if (confirm('Archive this evidence? The analysis will be marked as complete.')) {
                showNotification(`üì¶ Evidence ${caseId} archived successfully`, 'success');
            }
        }
        
        // ===== FILTER FUNCTIONS =====
        function filterQueue(event, filter) {
            currentFilter = filter;
            
            // Update active state
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            
            // Add active class to clicked button
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
            
            // Filter evidence cards
            const cards = document.querySelectorAll('.evidence-card-premium');
            cards.forEach(card => {
                if (filter === 'all') {
                    card.style.display = 'block';
                } else if (filter === 'high' && card.dataset.priority === 'high') {
                    card.style.display = 'block';
                } else if (filter === 'pending' && card.dataset.status === 'pending') {
                    card.style.display = 'block';
                } else if (filter === 'processing' && card.dataset.status === 'processing') {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
            
            showNotification(`Filtered: Showing ${filter} items`, 'info');
        }
        
        // ===== MODAL FUNCTIONS =====
        function showModal(title, content) {
            const modal = document.getElementById('analysisModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            
            modalTitle.textContent = title;
            modalContent.innerHTML = content;
            modal.classList.add('active');
            
            // Reinitialize icons in modal
            lucide.createIcons();
        }
        
        function closeModal() {
            document.getElementById('analysisModal').classList.remove('active');
        }
        
        // ===== UTILITY FUNCTIONS =====
        function showNotification(message, type = 'info') {
            // Escape message to prevent XSS
            const escapedMessage = escapeHtml ? escapeHtml(message) : message;
            
            const notification = document.createElement('div');
            notification.className = `toast toast-${type}`;
            notification.innerHTML = `
                <div class="toast-content">
                    <span>${escapedMessage}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="toast-close">
                        <i data-lucide="x"></i>
                    </button>
                </div>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#d32f2f' : '#3b82f6'};
                color: white;
                padding: 12px 16px;
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 400px;
            `;
            
            document.body.appendChild(notification);
            lucide.createIcons();
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        function refreshTools() {
            showNotification('üîÑ Synchronizing forensic tools with blockchain...', 'info');
            setTimeout(() => {
                showNotification('‚úÖ All tools synced successfully', 'success');
            }, 2000);
        }
        
        function startDigitalForensics() {
            showNotification('üíª Digital forensics analysis initialized', 'success');
            closeModal();
        }
        
        function startDNAAnalysis() {
            showNotification('üß¨ DNA analysis pipeline started', 'success');
            closeModal();
        }
        
        function startBallisticsAnalysis() {
            showNotification('üéØ Ballistics analysis initialized', 'success');
            closeModal();
        }
        
        function startToxicology() {
            showNotification('‚öóÔ∏è Toxicology panel running', 'success');
            closeModal();
        }
        
        function startDocumentAnalysis() {
            showNotification('üìÑ Document analysis in progress', 'success');
            closeModal();
        }
        
        function startImageAnalysis() {
            showNotification('üì∏ Image forensics analysis started', 'success');
            closeModal();
        }
        
        function downloadReport(caseId) {
            showNotification(`üì• Downloading report for ${caseId}`, 'info');
            closeModal();
        }
        
        // HTML escaping function (if not defined elsewhere)
        if (typeof escapeHtml !== 'function') {
            function escapeHtml(value) {
                if (value === undefined || value === null) return '';
                return String(value)
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            }
        }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    localStorage.clear();
                } catch (e) {
                    console.error('Error clearing localStorage:', e);
                }
                window.location.href = 'index.html';
            }
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('analysisModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
    <script src="footer.js"></script>
</body>

</html>